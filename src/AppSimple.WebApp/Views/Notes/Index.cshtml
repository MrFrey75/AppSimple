@model NoteListViewModel
@{
    ViewData["Title"] = "My Notes";
}

<div class="page-header">
    <div>
        <div class="page-title">üìù My Notes</div>
        <div class="page-subtitle">@Model.Notes.Count note@(Model.Notes.Count == 1 ? "" : "s")</div>
    </div>
    <div style="display:flex;gap:0.5rem;">
        <a asp-controller="Notes" asp-action="Tags" class="btn btn-secondary">üè∑ Tags</a>
        <a asp-controller="Notes" asp-action="Create" class="btn btn-primary">+ New Note</a>
    </div>
</div>

@if (Model.Notes.Count == 0)
{
    <div class="card" style="text-align:center;padding:3rem;">
        <p style="color:var(--subtext);margin-bottom:1rem;">You have no notes yet.</p>
        <a asp-controller="Notes" asp-action="Create" class="btn btn-primary">Create your first note</a>
    </div>
}
else
{
    <div style="display:grid;gap:1rem;">
        @foreach (var note in Model.Notes)
        {
            <div class="card" style="padding:1.25rem;">
                <div style="display:flex;align-items:flex-start;justify-content:space-between;gap:1rem;">
                    <div style="flex:1;min-width:0;">
                        <a asp-controller="Notes" asp-action="Detail" asp-route-uid="@note.Uid"
                           style="font-size:1.1rem;font-weight:600;color:var(--text);">
                            @(string.IsNullOrEmpty(note.Title) ? "(untitled)" : note.Title)
                        </a>
                        <p style="color:var(--subtext);font-size:0.85rem;margin-top:0.3rem;
                                  white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">
                            @(note.Content.Length > 120 ? note.Content[..120] + "‚Ä¶" : note.Content)
                        </p>
                        @if (note.Tags.Count > 0)
                        {
                            <div style="display:flex;flex-wrap:wrap;gap:0.3rem;margin-top:0.5rem;">
                                @foreach (var tag in note.Tags)
                                {
                                    <span style="background:@(tag.Color ?? "#CCCCCC")22;border:1px solid @(tag.Color ?? "#CCCCCC");
                                                 color:var(--text);border-radius:4px;padding:0.1rem 0.5rem;font-size:0.75rem;">
                                        @tag.Name
                                    </span>
                                }
                            </div>
                        }
                    </div>
                    <div style="display:flex;gap:0.4rem;flex-shrink:0;">
                        <a asp-controller="Notes" asp-action="Edit" asp-route-uid="@note.Uid"
                           class="btn btn-secondary btn-sm">Edit</a>
                        <form asp-controller="Notes" asp-action="Delete" asp-route-uid="@note.Uid" method="post"
                              onsubmit="return confirm('Delete this note?')">
                            @Html.AntiForgeryToken()
                            <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                        </form>
                    </div>
                </div>
                <div style="color:var(--subtext);font-size:0.75rem;margin-top:0.5rem;">
                    Updated @note.UpdatedAt.ToString("yyyy-MM-dd HH:mm")
                </div>
            </div>
        }
    </div>
}
